<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>架构型设计模式 | 码农机器人</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="努力向前">
    
    <link rel="preload" href="/assets/css/0.styles.b8d0645b.css" as="style"><link rel="preload" href="/assets/js/app.61a85b1c.js" as="script"><link rel="preload" href="/assets/js/2.6b359b12.js" as="script"><link rel="preload" href="/assets/js/23.c1d826fa.js" as="script"><link rel="prefetch" href="/assets/js/10.6bf522d2.js"><link rel="prefetch" href="/assets/js/100.a249a4e9.js"><link rel="prefetch" href="/assets/js/101.9d2465ad.js"><link rel="prefetch" href="/assets/js/102.5ea0ea92.js"><link rel="prefetch" href="/assets/js/103.ad073f03.js"><link rel="prefetch" href="/assets/js/104.afd1455c.js"><link rel="prefetch" href="/assets/js/105.5429d9b6.js"><link rel="prefetch" href="/assets/js/106.012719c5.js"><link rel="prefetch" href="/assets/js/107.fa002f10.js"><link rel="prefetch" href="/assets/js/108.9c70864a.js"><link rel="prefetch" href="/assets/js/109.ab6712ef.js"><link rel="prefetch" href="/assets/js/11.07adb038.js"><link rel="prefetch" href="/assets/js/110.3496849e.js"><link rel="prefetch" href="/assets/js/111.0708cccd.js"><link rel="prefetch" href="/assets/js/112.3ddda9ff.js"><link rel="prefetch" href="/assets/js/113.a826b4ec.js"><link rel="prefetch" href="/assets/js/114.54f06bf1.js"><link rel="prefetch" href="/assets/js/115.68bd2270.js"><link rel="prefetch" href="/assets/js/116.0e283e33.js"><link rel="prefetch" href="/assets/js/117.10ca7c11.js"><link rel="prefetch" href="/assets/js/118.0f21544b.js"><link rel="prefetch" href="/assets/js/119.3d5cdaf0.js"><link rel="prefetch" href="/assets/js/12.6a633ec9.js"><link rel="prefetch" href="/assets/js/13.2e8873e5.js"><link rel="prefetch" href="/assets/js/14.0ea5ac55.js"><link rel="prefetch" href="/assets/js/15.d24d1240.js"><link rel="prefetch" href="/assets/js/16.bfb99431.js"><link rel="prefetch" href="/assets/js/17.0bf6db21.js"><link rel="prefetch" href="/assets/js/18.f6a16197.js"><link rel="prefetch" href="/assets/js/19.15b1e095.js"><link rel="prefetch" href="/assets/js/20.56746f5a.js"><link rel="prefetch" href="/assets/js/21.5019bb92.js"><link rel="prefetch" href="/assets/js/22.36a83eaf.js"><link rel="prefetch" href="/assets/js/24.66437f58.js"><link rel="prefetch" href="/assets/js/25.b5ef9760.js"><link rel="prefetch" href="/assets/js/26.1e34c193.js"><link rel="prefetch" href="/assets/js/27.ea4375e5.js"><link rel="prefetch" href="/assets/js/28.8e440e91.js"><link rel="prefetch" href="/assets/js/29.ffd2070e.js"><link rel="prefetch" href="/assets/js/3.a6d8cb97.js"><link rel="prefetch" href="/assets/js/30.c1451f4e.js"><link rel="prefetch" href="/assets/js/31.a21ecc83.js"><link rel="prefetch" href="/assets/js/32.5d1de9ff.js"><link rel="prefetch" href="/assets/js/33.f9eef1d1.js"><link rel="prefetch" href="/assets/js/34.edb8fde2.js"><link rel="prefetch" href="/assets/js/35.6950ed93.js"><link rel="prefetch" href="/assets/js/36.b394a848.js"><link rel="prefetch" href="/assets/js/37.f11aa33f.js"><link rel="prefetch" href="/assets/js/38.e86bdf7f.js"><link rel="prefetch" href="/assets/js/39.dbc9c882.js"><link rel="prefetch" href="/assets/js/4.f3783df1.js"><link rel="prefetch" href="/assets/js/40.470a2b37.js"><link rel="prefetch" href="/assets/js/41.bcffb885.js"><link rel="prefetch" href="/assets/js/42.484ee502.js"><link rel="prefetch" href="/assets/js/43.2a86b409.js"><link rel="prefetch" href="/assets/js/44.2b684e4d.js"><link rel="prefetch" href="/assets/js/45.4e6fb818.js"><link rel="prefetch" href="/assets/js/46.86268f46.js"><link rel="prefetch" href="/assets/js/47.84f7cda3.js"><link rel="prefetch" href="/assets/js/48.fd78be04.js"><link rel="prefetch" href="/assets/js/49.f5a6fc1e.js"><link rel="prefetch" href="/assets/js/5.892f2cf8.js"><link rel="prefetch" href="/assets/js/50.29919944.js"><link rel="prefetch" href="/assets/js/51.c1b5918c.js"><link rel="prefetch" href="/assets/js/52.c4ad64f8.js"><link rel="prefetch" href="/assets/js/53.df154372.js"><link rel="prefetch" href="/assets/js/54.4fee1b96.js"><link rel="prefetch" href="/assets/js/55.18c6e9f2.js"><link rel="prefetch" href="/assets/js/56.d5569485.js"><link rel="prefetch" href="/assets/js/57.9eb74b69.js"><link rel="prefetch" href="/assets/js/58.c8b7968e.js"><link rel="prefetch" href="/assets/js/59.a208d99c.js"><link rel="prefetch" href="/assets/js/6.a9a81823.js"><link rel="prefetch" href="/assets/js/60.c0f7048b.js"><link rel="prefetch" href="/assets/js/61.e06e2c12.js"><link rel="prefetch" href="/assets/js/62.3726a0b9.js"><link rel="prefetch" href="/assets/js/63.53a81692.js"><link rel="prefetch" href="/assets/js/64.ba6af384.js"><link rel="prefetch" href="/assets/js/65.2f165ffa.js"><link rel="prefetch" href="/assets/js/66.8c0a983a.js"><link rel="prefetch" href="/assets/js/67.74bf1c32.js"><link rel="prefetch" href="/assets/js/68.27c15e0b.js"><link rel="prefetch" href="/assets/js/69.5b78d6fb.js"><link rel="prefetch" href="/assets/js/7.a9e85c97.js"><link rel="prefetch" href="/assets/js/70.4772f9bd.js"><link rel="prefetch" href="/assets/js/71.2a2e89e4.js"><link rel="prefetch" href="/assets/js/72.3debedf0.js"><link rel="prefetch" href="/assets/js/73.c9ee93ce.js"><link rel="prefetch" href="/assets/js/74.7ec9495c.js"><link rel="prefetch" href="/assets/js/75.8c828ff5.js"><link rel="prefetch" href="/assets/js/76.986dc0d7.js"><link rel="prefetch" href="/assets/js/77.7e7e3c8e.js"><link rel="prefetch" href="/assets/js/78.200d9828.js"><link rel="prefetch" href="/assets/js/79.ee6b28e9.js"><link rel="prefetch" href="/assets/js/8.448002b9.js"><link rel="prefetch" href="/assets/js/80.93d03d67.js"><link rel="prefetch" href="/assets/js/81.eebcba15.js"><link rel="prefetch" href="/assets/js/82.3b0bb838.js"><link rel="prefetch" href="/assets/js/83.75234d18.js"><link rel="prefetch" href="/assets/js/84.1a897e55.js"><link rel="prefetch" href="/assets/js/85.8267b168.js"><link rel="prefetch" href="/assets/js/86.a7557c20.js"><link rel="prefetch" href="/assets/js/87.4f7e77b3.js"><link rel="prefetch" href="/assets/js/88.9b41f10e.js"><link rel="prefetch" href="/assets/js/89.662b9425.js"><link rel="prefetch" href="/assets/js/9.804860d0.js"><link rel="prefetch" href="/assets/js/90.6d84e2d8.js"><link rel="prefetch" href="/assets/js/91.650a7b6f.js"><link rel="prefetch" href="/assets/js/92.8568032c.js"><link rel="prefetch" href="/assets/js/93.0c300b40.js"><link rel="prefetch" href="/assets/js/94.f7ce23ff.js"><link rel="prefetch" href="/assets/js/95.e6c8272f.js"><link rel="prefetch" href="/assets/js/96.8f51c3ac.js"><link rel="prefetch" href="/assets/js/97.9cc683f5.js"><link rel="prefetch" href="/assets/js/98.6af1269f.js"><link rel="prefetch" href="/assets/js/99.97a09de8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8d0645b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="码农机器人" class="logo"> <span class="site-name can-hide">码农机器人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>建立前端知识体系</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>提效赋能 前端工程化篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>程序员PLUS篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaScript设计模式</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/JavaScript设计模式/创建型设计模式.html" class="sidebar-link">创建型设计模式</a></li><li><a href="/note/JavaScript设计模式/结构型设计模式.html" class="sidebar-link">结构型设计模式</a></li><li><a href="/note/JavaScript设计模式/行为型设计模式.html" class="sidebar-link">行为型设计模式</a></li><li><a href="/note/JavaScript设计模式/技巧型设计模式.html" class="sidebar-link">技巧型设计模式</a></li><li><a href="/note/JavaScript设计模式/架构型设计模式.html" class="active sidebar-link">架构型设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#模块模式" class="sidebar-link">模块模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#同步模块模式" class="sidebar-link">同步模块模式</a></li><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#异步模块模式" class="sidebar-link">异步模块模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#widget模式" class="sidebar-link">Widget模式</a></li><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#mvc思想" class="sidebar-link">MVC思想</a></li><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#mvp思想" class="sidebar-link">MVP思想</a></li><li class="sidebar-sub-header"><a href="/note/JavaScript设计模式/架构型设计模式.html#mvvm思想" class="sidebar-link">MVVM思想</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>知识点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>忍者秘籍书</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="架构型设计模式"><a href="#架构型设计模式" class="header-anchor">#</a> 架构型设计模式</h1> <h2 id="模块模式"><a href="#模块模式" class="header-anchor">#</a> 模块模式</h2> <p><strong>模块化：</strong> 将复杂的系统分解成高内聚，低耦合的模块，使系统开发变得可控、可维护、可拓展、提高模块的复用率。</p> <h3 id="同步模块模式"><a href="#同步模块模式" class="header-anchor">#</a> 同步模块模式</h3> <p>请求发出后，无论模块是否存在，立即执行后续的逻辑，实现模块开发中对模块的立即引用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//模块管理器单体对象</span>

<span class="token comment">//定义模块管理器单体对象</span>
<span class="token keyword">var</span> <span class="token constant">F</span> <span class="token operator">=</span> <span class="token constant">F</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/***
*@param str 模块路由
*@param fn 模块方法
**/</span>

<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function-variable function">define</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str <span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//解析路由</span>
    <span class="token keyword">var</span> parts <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当前模块的祖父模块，parent当前模块父模块</span>
        old <span class="token operator">=</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">//i 模块层级，len 模块层级长度</span>
        i <span class="token operator">=</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">//如果第一个模块是模块管理器单体对象，则移除</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            parts <span class="token operator">=</span> parts<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//屏蔽对define与module模块方法的重写</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;define&quot;</span> <span class="token operator">||</span> parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//遍历路由模块并定义每层模块</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i  <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            old <span class="token operator">=</span> parent<span class="token punctuation">;</span>
            parent <span class="token operator">=</span> parent<span class="token punctuation">[</span>parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//如果给定模块方法则定义该模块方法</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
            old<span class="token punctuation">[</span>parts<span class="token punctuation">[</span><span class="token operator">--</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;say.hello&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//模块调用方法</span>
<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function-variable function">module</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//将参数转化为数组</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//获取执行函数</span>
        fn <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//获取模块依赖，如果args[0] 是数组，则依赖模块为args[0]，否则依赖模块为args</span>
        parts <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span> <span class="token operator">?</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">:</span>args<span class="token punctuation">,</span>
        <span class="token comment">//依赖模块列表</span>
        modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">//模块路由</span>
        modIDs <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
        i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">,</span>
        <span class="token comment">//依赖模块长度</span>
        ilen <span class="token operator">=</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        <span class="token comment">//父模块，模块路由层级索引，模块路由层级长度</span>
        parent<span class="token punctuation">,</span>j<span class="token punctuation">,</span>jlen<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> ilen<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//解析模块路由，并屏蔽模块父对象</span>
        modIDs <span class="token operator">=</span> parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^F\.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modIDs<span class="token punctuation">.</span>length <span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            parent <span class="token operator">=</span> parent<span class="token punctuation">[</span>modIDs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//将模块添加到依赖模块列表中</span>
        modules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//构造函数执行环境</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'say.hello'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">say</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token string">&quot;say Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="异步模块模式"><a href="#异步模块模式" class="header-anchor">#</a> 异步模块模式</h3> <p>请求发出后，继续其他业务逻辑，知道模块加载未完成执行后续的逻辑，实现模块开发中对模块加载完成后的引用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
    *   闭包环境 
    **/</span>
    <span class="token comment">// 向闭包中传入模块管理其对象F（~屏蔽雅素偶文件时，前面漏写;报错） </span>
    <span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">F</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模块缓存器。存储已创建模块</span>
        <span class="token keyword">var</span> moduleCache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建模块管理器对象F，并保存在全局作用域中</span>
        <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token constant">F</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
 
    <span class="token comment">/**
    *   创建或调用模块方法
    *   @param  url             参数为模块URL
    *   @param  deps            参数为依赖模块 
    *   @param  callback        参数为模块主函数
    **/</span>
   <span class="token constant">F</span><span class="token punctuation">.</span><span class="token function-variable function">module</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> modDeps<span class="token punctuation">,</span> modCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将参数转化为数组</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 获取模块构造函数（参数数组中最后一个参数成员）</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 获取依赖模块（紧邻回调函数参数，且数据类型为数组）</span>
    <span class="token keyword">var</span> deps <span class="token operator">=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token operator">?</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> 
    <span class="token comment">// 该模块URL（模块ID）</span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> args<span class="token punctuation">.</span>length <span class="token operator">?</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">;</span>
    <span class="token comment">// 依赖模块序列</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">;</span>
    <span class="token comment">// 未加载的依赖模块数量统计</span>
    <span class="token keyword">var</span> depsCount <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token comment">// 依赖模块序列中索引值</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
    <span class="token comment">// 依赖模块序列长度</span>
    <span class="token keyword">var</span> len <span class="token punctuation">;</span>
    <span class="token comment">// 获取依赖模块长度</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">=</span> deps<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 遍历依赖模块</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 闭包保存i</span>
            <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 增加未加载依赖模块数量统计</span>
                depsCount<span class="token operator">++</span> <span class="token punctuation">;</span>
                <span class="token comment">// 异步加载依赖模块</span>
                <span class="token function">loadModule</span><span class="token punctuation">(</span>deps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 依赖模块序列中添加依赖模块接口引用</span>
                    params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> mod <span class="token punctuation">;</span>
                    <span class="token comment">// 依赖模块加载完成，依赖模块数量统计减一</span>
                    depsCount<span class="token operator">--</span> <span class="token punctuation">;</span>
                    <span class="token comment">// 如果依赖模块全部加载</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>depsCount <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 在模块缓存器中矫正该模块，并执行构造函数</span>
                        <span class="token function">setModule</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token comment">// 遍历下一依赖模块</span>
            i<span class="token operator">++</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token comment">// 无依赖模块，直接执行回调函数   </span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在模块缓存器中矫正该模块，并执行构造函数</span>
        <span class="token function">setModule</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 加载模块</span>
<span class="token keyword">var</span> moduleCache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
 
<span class="token comment">/***
*   异步加载依赖模块所在文件
*   @param      moduleName      模块路径（id）
*   @param      callback        模块加载完成回调函数
**/</span>
<span class="token keyword">var</span> <span class="token function-variable function">loadModule</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 依赖模块</span>
    <span class="token keyword">var</span> _module <span class="token punctuation">;</span>
    <span class="token comment">// 如果依赖模块被要求加载过</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>moduleCache<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取该模块信息</span>
        _module <span class="token operator">=</span> moduleCache<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span> <span class="token punctuation">;</span>
        <span class="token comment">// 如果模块加载完成</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_module<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'loaded'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 执行模块加载完成回调函数</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">(</span>_module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 缓存该模块所处文件加载完成回调函数</span>
            _module<span class="token punctuation">.</span>onload<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token comment">// 模块第一次被依赖引用   </span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 缓存该模块初始化信息</span>
        moduleCache<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
 
            <span class="token literal-property property">moduleName</span> <span class="token operator">:</span> moduleName<span class="token punctuation">,</span>        <span class="token comment">// 模块id</span>
            <span class="token literal-property property">status</span> <span class="token operator">:</span> <span class="token string">'loading'</span><span class="token punctuation">,</span>             <span class="token comment">// 模块对应文件加载状态（默认加载中）</span>
            <span class="token literal-property property">exports</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>                 <span class="token comment">// 模块接口</span>
            <span class="token literal-property property">onload</span> <span class="token operator">:</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span>             <span class="token comment">// 模块对应文件加载完成回调函数缓冲器</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 加载模块对应文件</span>
        <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token function">getUrl</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token punctuation">;</span>
<span class="token comment">// 获取文件路径</span>
<span class="token keyword">var</span> <span class="token function-variable function">getUrl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">moduleName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 拼接完整的文件路径字符串，如'lib/ajas' =&gt; 'lib/ajax.js'</span>
    <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.js'</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">;</span>
<span class="token comment">// 加载脚本文件</span>
<span class="token keyword">var</span> <span class="token function-variable function">loadScript</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 文本类型</span>
    _script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/JavaScript'</span> <span class="token punctuation">;</span>
    <span class="token comment">// 确认编码</span>
    _script<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">'UTF-8'</span> <span class="token punctuation">;</span>
    <span class="token comment">// 异步加载</span>
    _script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">;</span>
    <span class="token comment">// 文件路径</span>
    _script<span class="token punctuation">.</span>src <span class="token operator">=</span> src <span class="token punctuation">;</span>
    <span class="token comment">// 插入页面中</span>
    document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>_script<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token comment">/***
*   设置模块并执行模块构造函数
*   @param   moduleName         模块id名称
*   @param   params             依赖模块
*   @param   callback           模块构造函数
**/</span> 
<span class="token keyword">var</span> <span class="token function-variable function">setModule</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> params<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 模块容器，模块文件加载完成回调函数</span>
    <span class="token keyword">var</span> _module<span class="token punctuation">,</span> fn <span class="token punctuation">;</span>
    <span class="token comment">// 如果模块被调用过</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>moduleCache<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取模块</span>
        _module <span class="token operator">=</span> moduleCache<span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span> <span class="token punctuation">;</span>
        <span class="token comment">// 设置模块已经加载完成</span>
        _module<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">'loaded'</span> <span class="token punctuation">;</span>
        <span class="token comment">// 矫正模块接口</span>
        _module<span class="token punctuation">.</span>exports <span class="token operator">=</span> callback <span class="token operator">?</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_module<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">;</span>
        <span class="token comment">// 执行模块文件加载完成回调函数</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>fn <span class="token operator">=</span> _module<span class="token punctuation">.</span>onload<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">(</span>_module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 模块不存在（匿名函数），则直接执行构造函数</span>
        callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//lib/dom.js</span>
<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'lib/dom'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取元素方法</span>
        <span class="token function-variable function">g</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 获取或者设置元素内容方法</span>
        <span class="token function-variable function">html</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html <span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">//lib/event.js文件</span>

<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'lib/event'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'lib/dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> events <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 绑定事件</span>
        <span class="token function-variable function">on</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dom<span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'on'</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">return</span> events<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>


<span class="token comment">//测试</span>
<span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lib/event'</span><span class="token punctuation">,</span> <span class="token string">'lib/dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">events<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    events<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dom<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'demo'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

</code></pre></div><h2 id="widget模式"><a href="#widget模式" class="header-anchor">#</a> Widget模式</h2> <p><strong>概述:</strong> (Web Widget指的是一块可以在任意页面中执行代码块)Widget模式是指借用Web Widget思想将页面分解成部件，针对部件开发，最终组合成完整的 页面。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>设计模式知识连载（47）---Widget模式:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
        （Web Widget指的是一块可以在任意页面中执行的代码块）Widget模式是指借用Web Widget思想将页面分解成部件，针对部件开发，最终组合成完整的页面。
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--===============模板种类开始===========--&gt;</span>
<span class="token comment">&lt;!-- 页面元素内容 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>demo_tag<span class="token punctuation">'</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>template<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tag_cloud<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {% for(var i = 0; i &lt; tagCloud.length; i++){
            var ctx = tagCloud[i];
        %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tag_item {% if(ctx['is_selected']) { %}selected{% } %}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{%=ctx['title']%}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {% =ctx['text'] %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>    
        {% } %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 表单元素内的内容 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo_textarea<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>template<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tag_cloud<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {%  for(var i = 0; i &lt; tagCloud.length; i++) {
            var ctx = tagCloud[i]; %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tag_item 
            {% if(ctx['is_selected']){ %}
            selected
            {% } %} <span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{%=ctx['title']%}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {% =ctx[text] %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        {% } %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- srcpt模板内容 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/template<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>demo_script<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;tag_cloud&quot;</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tagCloud<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token keyword">var</span> ctx <span class="token operator">=</span> tagCloud<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token operator">%</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span>&quot;tag_item 
            <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ctx<span class="token punctuation">[</span><span class="token string">'is_selected'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token punctuation">}</span>
            selected
            <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token punctuation">}</span><span class="token string">&quot; title=&quot;</span><span class="token punctuation">{</span><span class="token operator">%=</span>ctx<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token punctuation">}</span>&quot;<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token operator">%=</span>ctx<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 自定义模板 --&gt;</span>
<span class="token comment">&lt;!--===============模板种类结束===========--&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

    <span class="token comment">// 模拟数据</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tagCloud</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">is_selected</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span> <span class="token operator">:</span> <span class="token string">'这是一本设计模式书'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span> <span class="token operator">:</span> <span class="token string">'设计模式'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">is_selected</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span> <span class="token operator">:</span> <span class="token string">'这是一本HTML'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span> <span class="token operator">:</span> <span class="token string">'HTML'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">is_selected</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span> <span class="token operator">:</span> <span class="token string">'这是一本CSS'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span> <span class="token operator">:</span> <span class="token string">'CSS'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">is_selected</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span> <span class="token operator">:</span> <span class="token string">'这是一本javascript'</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span> <span class="token operator">:</span> <span class="token string">'javascript'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    *   案例一：视图模块化，方式一：初始
    */</span>

    <span class="token comment">/*===============实现原理开始===========*/</span>
    <span class="token comment">/**** 
    *   模板：
    *   &lt;a href = '#' class = 'data-lang{%if(is_selected){%}selected{%}%}' value = '{%=value%}'&gt;{%=text%}&lt;/a&gt;
    ****/</span>   
    <span class="token comment">/**** 
    *   数据：
    *   {is_selected : true, value : 'zh', text : 'zh-text'}
    ****/</span>
    <span class="token comment">/**** 
    *   输出结果：
    *   &lt;a href = '#' class = 'data-lang selected' value = 'zh'&gt;zh-text&lt;/a&gt;
    ****/</span>
    <span class="token comment">/*===============实现原理结束===========*/</span>

    <span class="token comment">/*===============模板引擎模块开始===========*/</span>
    <span class="token comment">// 模板引擎模块</span>
    <span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'lib/template'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">/***
        *   模板引擎，处理数据的编译模板入口
        *   @param  str     模块容器id或者模板字符串
        *   @param  data    渲染数据
        **/</span> 
        <span class="token keyword">var</span> <span class="token function-variable function">_TplEngine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果数据是数组</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 缓存渲染模板结果</span>
                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">;</span>
                <span class="token comment">// 数据索引</span>
                <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span>
                <span class="token comment">// 数据长度</span>
                <span class="token keyword">var</span> len <span class="token operator">=</span> data<span class="token punctuation">.</span>length <span class="token punctuation">;</span>
                <span class="token comment">// 遍历数据</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 缓存模板渲染结果，也可以写成</span>
                    <span class="token comment">// html += arguments.callee(str, data[i]) ;</span>
                    html <span class="token operator">+=</span> <span class="token function">_getTpl</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 返回模板渲染最终结果</span>
                <span class="token keyword">return</span> html <span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 返回模板渲染结果</span>
                <span class="token keyword">return</span> <span class="token function">_getTpl</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token punctuation">;</span>
        <span class="token comment">/***
        *   获取模板
        *   @param  str 模板容器id，或者模板字符串
        **/</span>
        <span class="token keyword">var</span> <span class="token function-variable function">_getTpl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取元素</span>
            <span class="token keyword">var</span> ele <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token comment">// 如果元素存在</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 如果是input或者textarea表单元素，则获取该元素的value值，否则获取元素的内容</span>
                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(textarea | input)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span> <span class="token operator">?</span> ele<span class="token punctuation">.</span>value <span class="token operator">:</span> ele<span class="token punctuation">.</span>innerHTML <span class="token punctuation">;</span>
                <span class="token comment">// 编译模板</span>
                <span class="token keyword">return</span> <span class="token function">_compileTpl</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 编译模板</span>
                <span class="token keyword">return</span> <span class="token function">_compileTpl</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token punctuation">;</span>
        <span class="token comment">// 处理模板</span>
        <span class="token keyword">var</span> <span class="token function-variable function">_dealTpl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 左分隔符</span>
            <span class="token keyword">var</span> _left <span class="token operator">=</span> <span class="token string">'{%'</span> <span class="token punctuation">;</span>
            <span class="token comment">// 右分隔符</span>
            <span class="token keyword">var</span> _right <span class="token operator">=</span> <span class="token string">'%}'</span> <span class="token punctuation">;</span>
            <span class="token comment">// 显示转化为字符串</span>
            <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
                <span class="token comment">// 转义标签内的&lt;如：&lt;div&gt;{%if(a&amp;lt;b)%}&lt;/div&gt; -&gt; &lt;div&gt;{%if(a&lt;b)%}&lt;/div&gt;</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&lt;'</span><span class="token punctuation">)</span>
                <span class="token comment">// 转义标签内的&gt;</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'&gt;'</span><span class="token punctuation">)</span>
                <span class="token comment">// 过滤回车符，制表符，回车符</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\r\t\n]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token comment">// 替换内容</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>_left <span class="token operator">+</span> <span class="token string">'=(.*?)'</span> <span class="token operator">+</span> _right<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;',typeof($1) === 'undefined' ? '' : $1, '&quot;</span><span class="token punctuation">)</span> 
                <span class="token comment">// 替换左分隔符</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>_left<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;');&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// 替换右分隔符</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>_right<span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;template_array.push('&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token punctuation">;</span>
        <span class="token comment">/***
        *   编译执行
        *   @param  str 模板数据
        **/</span> 
        <span class="token keyword">var</span> <span class="token function-variable function">_compileTpl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 编译函数体</span>
            <span class="token keyword">var</span> fnBody <span class="token operator">=</span> <span class="token string">&quot;var template_array=[];\nvar fn=(function(data){\nvar template_key='';\nfor(key in data){\ntemplate_key +=(''+key+'=data[\&quot;'+key+'\&quot;];');\n}\neval(template_key);\ntemplate_array.push('&quot;</span><span class="token operator">+</span><span class="token function">_dealTpl</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;');\ntemplate_key=null;\n})(templateData);\nfn=null;\nreturn template_array.join('') ;&quot;</span> <span class="token punctuation">;</span>
            <span class="token comment">// 编译函数</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'templateData'</span><span class="token punctuation">,</span>  fnBody<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token punctuation">;</span>

        <span class="token comment">// 返回</span>
        <span class="token keyword">return</span> _TplEngine <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

    <span class="token comment">/*######fnBody分析开始######*/</span>
    <span class="token comment">// &quot;// 声明template_array模板容器组</span>
    <span class="token comment">// var template_array = [] ; \n</span>
    <span class="token comment">// // 闭包，模板容器组添加成员</span>
    <span class="token comment">// var fn = (function(data) { \n</span>
    <span class="token comment">//  // 渲染数据变量的执行函数体</span>
    <span class="token comment">//  var template_key = '' ; \n</span>
    <span class="token comment">//  // 遍历渲染数据</span>
    <span class="token comment">//  for(key in data) { \n</span>
    <span class="token comment">//      // 为渲染数据变量的执行函数体添加赋值语句</span>
    <span class="token comment">//      template_key += ('' + key + '=data[\&quot;'+ key +'\&quot;] ;') ; \n </span>
    <span class="token comment">//  } \n</span>
    <span class="token comment">//  // 执行渲染数据变量函数</span>
    <span class="token comment">//  eval(template_key) ; \n</span>
    <span class="token comment">//  // 为模板容器组添加成员（注意，此时渲染数据将替换容器中的变量）</span>
    <span class="token comment">//  template_array.push('&quot;+ _dealTpl(str) +&quot;') ; \n</span>
    <span class="token comment">//  //释放渲染数据变量函数</span>
    <span class="token comment">//  template_key = null ; \n</span>
    <span class="token comment">// // 为闭包传入数据   </span>
    <span class="token comment">// })(templateData) ; \n</span>
    <span class="token comment">// // 释放闭包</span>
    <span class="token comment">// fn = null ; \n</span>
    <span class="token comment">// // 返回渲染后的模板容器组，并拼接成字符串</span>
    <span class="token comment">// return template_array.join('') ;&quot;</span>
    <span class="token comment">/*######fnBody分析结束######*/</span>

    <span class="token comment">// 使用时，只需引用模板引擎模块依赖就可以</span>
    <span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'lib/template'</span><span class="token punctuation">,</span> <span class="token string">'lib/dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">template<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 服务器端获取到data数据逻辑</span>
        <span class="token comment">// 创建组件视图逻辑</span>
        <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">'demo_script'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        dom<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token comment">// 组件其他交互逻辑</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">/*===============模板引擎模块结束===========*/</span>

    <span class="token comment">/*===============模板种类结束===========*/</span>
    <span class="token comment">// 自定义模板</span>
    <span class="token keyword">var</span> demo_tpl <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'&lt;div id=&quot;tag_cloud&quot;&gt;'</span><span class="token punctuation">,</span>
        <span class="token string">'{% for(var i = 0; i &lt; tagCloud.length; i++){'</span><span class="token punctuation">,</span> 
            <span class="token string">' var ctx = tagCloud[i]; %}'</span><span class="token punctuation">,</span>
            <span class="token string">'&lt;a href=&quot;#&quot; class=&quot;tag_item {% if(ctx[&quot;is_selected&quot;]){ %}'</span><span class="token punctuation">,</span>
            <span class="token string">'selected'</span><span class="token punctuation">,</span>
            <span class="token string">'{% } %}&quot; title=&quot;{%=ctx[&quot;title&quot;]%}&quot;&gt;'</span><span class="token punctuation">,</span>
            <span class="token string">'{%=ctx[&quot;text&quot;]%}'</span><span class="token punctuation">,</span>
            <span class="token string">'&lt;/a&gt;'</span><span class="token punctuation">,</span>
        <span class="token string">'{% } %}'</span><span class="token punctuation">,</span>
        <span class="token string">'&lt;/div&gt;'</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">/*===============模板种类结束===========*/</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="mvc思想"><a href="#mvc思想" class="header-anchor">#</a> MVC思想</h2> <p>MVC即模型(model)--视图(view)--控制器(controller)，用一种将业务逻辑、数据、视图分离的方式组织架构代码。</p> <p><img src="/knowledge/4001970182-7d28f8238595c520.png" alt=""></p> <ul><li>Model层：模型（用于封装业务逻辑相关的数据以及对数据的操纵）</li> <li>View层：视图（渲染图形化界面，也就是所谓的UI界面）</li> <li>Controller层：控制器（M和V之间的连接器，主要处理业务逻辑，包括显示数据，界面跳转，管理页面生命周期等）</li></ul> <p><strong>标准MVC工作思想：</strong> 当有用户的行为触发操作时，控制器（Controller）更新模型，并通知视图（V）和模型（M）更新，这时视图（V）就会向模型（M）请求新的数据，这就是标准MVC思想下Model，View 和 Controller 之间的协作方式。</p> <p><strong>MVC优点：</strong></p> <ol><li>耦合性低，视图层和业务层分离，这样就允许更改视图层代码而不用重新编译模型和控制器代码；</li> <li>重用性高；</li> <li>生命周期成本低；</li> <li>MVC使开发和维护用户接口的技术含量降低；</li> <li>可维护性高，分离视图层和业务逻辑层也使得WEB应用更易于维护和修改；</li> <li>部署快。</li></ol> <p><strong>MVC缺点：</strong></p> <ol><li>不适合小型，中等规模的应用程序，花费大量时间将MVC应用到规模并不是很大的应用程序通常会得不偿失。</li> <li>视图与控制器间过于紧密连接，视图与控制器是相互分离，但却是联系紧密的部件，视图没有控制器的存在，其应用是很有限的，反之亦然，这样就妨碍了他们的独立重用。</li> <li>视图对模型数据的低效率访问，依据模型操作接口的不同，视图可能需要多次调用才能获得足够的显示数据。对未变化数据的不必要的频繁访问，也将损害操作性能。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">~</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//MVC</span>
    <span class="token keyword">var</span> <span class="token function-variable function">MVC</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token constant">MVC</span><span class="token punctuation">.</span><span class="token function-variable function">model</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> <span class="token constant">M</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token constant">M</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">//左侧侧边栏导航服务器端请求得到的响应数据</span>
            <span class="token literal-property property">slideBar</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token comment">//...</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//新增模块追加代码</span>
            <span class="token literal-property property">newsMod</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token comment">//...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token constant">M</span><span class="token punctuation">.</span>conf <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">//侧边导航动画配置数据</span>
            <span class="token literal-property property">slideBarCloseAnimate</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token comment">//新增模块追加代码</span>
            <span class="token comment">//newModCof...</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment">//...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token constant">MVC</span><span class="token punctuation">.</span><span class="token function-variable function">view</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> <span class="token constant">M</span> <span class="token operator">=</span> <span class="token constant">MVC</span><span class="token punctuation">.</span>model<span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token constant">V</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">//创建侧边导航模块视图</span>
            <span class="token function-variable function">createSlideBar</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//新增模块追加代码</span>
            <span class="token function-variable function">createNewMod</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token constant">V</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">MVC</span><span class="token punctuation">.</span><span class="token function-variable function">ctrl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> <span class="token constant">V</span> <span class="token operator">=</span> <span class="token constant">MVC</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token constant">M</span> <span class="token operator">=</span> <span class="token constant">MVC</span><span class="token punctuation">.</span>model<span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">//侧边导航栏模块</span>
            <span class="token function-variable function">initSlideBar</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//...</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//新增模块追加代码</span>
            <span class="token function-variable function">initNewMod</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//...</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> <span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token constant">C</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">C</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>

</code></pre></div><h2 id="mvp思想"><a href="#mvp思想" class="header-anchor">#</a> MVP思想</h2> <p>MVP即模型(Model)--视图(View)--管理器(Presenter):View层不直接引用Model层内的数据，而是通过Presenter层实现对Model层内的数据访问。即所有层次的交互都发生在Presenter层中。</p> <p><img src="/knowledge/2241298228-ea0ab2ece60c4402.png" alt=""></p> <ul><li>Model层：模型（用于封装业务逻辑相关的数据以及对数据的操纵）</li> <li>View层：视图（渲染图形化界面，也就是所谓的UI界面）</li> <li>Presenter层：控制器（M和V之间的连接器，主要处理业务逻辑，包括显示数据，界面跳转，管理页面生命周期等）</li></ul> <p><strong>标准MVP工作思想:</strong> 在 MVP 中，Presenter 可以理解为松散的控制器，其中包含了视图的 UI 业务逻辑，所有从视图发出的事件，都会通过代理给 Presenter 进行处理；同时，Presenter 也通过视图暴露的接口与其进行通信。</p> <p><strong>MVP特点：</strong></p> <ol><li>M、V、P之间双向通信。</li> <li>View 与 Model 不通信，都通过 Presenter 传递。Presenter完全把Model和View进行了分离，主要的程序逻辑在Presenter里实现。</li> <li>View 非常薄，不部署任何业务逻辑，称为”被动视图”（Passive View），即没有任何主动性，而 Presenter非常厚，所有逻辑都部署在那里。</li> <li>Presenter与具体的View是没有直接关联的，而是通过定义好的接口进行交互，从而使得在变更View时候可以保持Presenter的不变，这样就可以重用。不仅如此，还可以编写测试用的View，模拟用户的各种操作，从而实现对Presenter的测试–从而不需要使用自动化的测试工具。</li></ol> <p><strong>MVP优点：</strong></p> <ol><li>模型与视图完全分离，我们可以修改视图而不影响模型；</li> <li>可以更高效地使用模型，因为所有的交互都发生在一个地方——Presenter内部；</li> <li>我们可以将一个Presenter用于多个视图，而不需要改变Presenter的逻辑。这个特性非常的有用，因为视图的变化总是比模型的变化频繁；</li> <li>如果我们把逻辑放在Presenter中，那么我们就可以脱离用户接口来测试这些逻辑（单元测试）。</li></ol> <p><strong>MVP缺点：</strong> 视图和Presenter的交互会过于频繁，使得他们的联系过于紧密。也就是说，一旦视图变更了，presenter也要变更。</p> <h2 id="mvvm思想"><a href="#mvvm思想" class="header-anchor">#</a> MVVM思想</h2> <p>模型(Model)--视图(View)--视图模型(ViewModel):为视图层(View)量身定做一套视图模型(ViewModel)，并在视图模型(ViewModel)中创建属性和方法，为视图层(View)绑定数据(Model)并实现交互。</p> <p><img src="/knowledge/88591437-25fabe485a7d6d05.png" alt=""></p> <ul><li>Model层：Model层代表了描述业务逻辑和数据的一系列类的集合。它也定义了数据修改和操作的业务规则。</li> <li>View层：View代表了UI组件，像CSS，JQuery，html等。他只负责展示从Presenter接收到的数据。也就是把模型转化成UI。</li> <li>View Model层：View Model负责暴漏方法，命令，其他属性来操作VIew的状态，组装model作为View动作的结果，并且触发view自己的事件。</li></ul> <p><strong>MVVM思想关键点：</strong></p> <ol><li>用户和View交互。</li> <li>View和ViewModel是多对一关系。意味着一个ViewModel只映射多个View。</li> <li>View持有ViewModel的引用，但是ViewModel没有任何View的信息。</li> <li>View 和ViewModel之间有双向数据绑定关系。</li></ol> <p><strong>MVVM优点：</strong></p> <ol><li>低耦合，视图（View）可以独立于Model变化和修改，一个ViewModel可以绑定到不同的”View”上，当View变化的时候Model可以不变，当Model变化的时候View也可以不变。</li> <li>可重用性，可以把一些视图逻辑放在一个ViewModel里面，让很多view重用这段视图逻辑。</li> <li>独立开发，开发人员可以专注于业务逻辑和数据的开发（ViewModel），设计人员可以专注于页面设计，使用Expression Blend可以很容易设计界面并生成xml代码。</li> <li>可测试，界面向来是比较难于测试的，而现在测试可以针对ViewModel来写。</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">12/15/2021, 6:14:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/JavaScript设计模式/技巧型设计模式.html" class="prev">
        技巧型设计模式
      </a></span> <span class="next"><a href="/note/http/HTTP协议.html">
        HTTP简介
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.61a85b1c.js" defer></script><script src="/assets/js/2.6b359b12.js" defer></script><script src="/assets/js/23.c1d826fa.js" defer></script>
  </body>
</html>
