<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 码农机器人</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="努力向前">
    
    <link rel="preload" href="/assets/css/0.styles.b8d0645b.css" as="style"><link rel="preload" href="/assets/js/app.61a85b1c.js" as="script"><link rel="preload" href="/assets/js/2.6b359b12.js" as="script"><link rel="preload" href="/assets/js/105.5429d9b6.js" as="script"><link rel="prefetch" href="/assets/js/10.6bf522d2.js"><link rel="prefetch" href="/assets/js/100.a249a4e9.js"><link rel="prefetch" href="/assets/js/101.9d2465ad.js"><link rel="prefetch" href="/assets/js/102.5ea0ea92.js"><link rel="prefetch" href="/assets/js/103.ad073f03.js"><link rel="prefetch" href="/assets/js/104.afd1455c.js"><link rel="prefetch" href="/assets/js/106.012719c5.js"><link rel="prefetch" href="/assets/js/107.fa002f10.js"><link rel="prefetch" href="/assets/js/108.9c70864a.js"><link rel="prefetch" href="/assets/js/109.ab6712ef.js"><link rel="prefetch" href="/assets/js/11.07adb038.js"><link rel="prefetch" href="/assets/js/110.3496849e.js"><link rel="prefetch" href="/assets/js/111.0708cccd.js"><link rel="prefetch" href="/assets/js/112.3ddda9ff.js"><link rel="prefetch" href="/assets/js/113.a826b4ec.js"><link rel="prefetch" href="/assets/js/114.54f06bf1.js"><link rel="prefetch" href="/assets/js/115.68bd2270.js"><link rel="prefetch" href="/assets/js/116.0e283e33.js"><link rel="prefetch" href="/assets/js/117.10ca7c11.js"><link rel="prefetch" href="/assets/js/118.0f21544b.js"><link rel="prefetch" href="/assets/js/119.3d5cdaf0.js"><link rel="prefetch" href="/assets/js/12.6a633ec9.js"><link rel="prefetch" href="/assets/js/13.2e8873e5.js"><link rel="prefetch" href="/assets/js/14.0ea5ac55.js"><link rel="prefetch" href="/assets/js/15.d24d1240.js"><link rel="prefetch" href="/assets/js/16.bfb99431.js"><link rel="prefetch" href="/assets/js/17.0bf6db21.js"><link rel="prefetch" href="/assets/js/18.f6a16197.js"><link rel="prefetch" href="/assets/js/19.15b1e095.js"><link rel="prefetch" href="/assets/js/20.56746f5a.js"><link rel="prefetch" href="/assets/js/21.5019bb92.js"><link rel="prefetch" href="/assets/js/22.36a83eaf.js"><link rel="prefetch" href="/assets/js/23.c1d826fa.js"><link rel="prefetch" href="/assets/js/24.66437f58.js"><link rel="prefetch" href="/assets/js/25.b5ef9760.js"><link rel="prefetch" href="/assets/js/26.1e34c193.js"><link rel="prefetch" href="/assets/js/27.ea4375e5.js"><link rel="prefetch" href="/assets/js/28.8e440e91.js"><link rel="prefetch" href="/assets/js/29.ffd2070e.js"><link rel="prefetch" href="/assets/js/3.a6d8cb97.js"><link rel="prefetch" href="/assets/js/30.c1451f4e.js"><link rel="prefetch" href="/assets/js/31.a21ecc83.js"><link rel="prefetch" href="/assets/js/32.5d1de9ff.js"><link rel="prefetch" href="/assets/js/33.f9eef1d1.js"><link rel="prefetch" href="/assets/js/34.edb8fde2.js"><link rel="prefetch" href="/assets/js/35.6950ed93.js"><link rel="prefetch" href="/assets/js/36.b394a848.js"><link rel="prefetch" href="/assets/js/37.f11aa33f.js"><link rel="prefetch" href="/assets/js/38.e86bdf7f.js"><link rel="prefetch" href="/assets/js/39.dbc9c882.js"><link rel="prefetch" href="/assets/js/4.f3783df1.js"><link rel="prefetch" href="/assets/js/40.470a2b37.js"><link rel="prefetch" href="/assets/js/41.bcffb885.js"><link rel="prefetch" href="/assets/js/42.484ee502.js"><link rel="prefetch" href="/assets/js/43.2a86b409.js"><link rel="prefetch" href="/assets/js/44.2b684e4d.js"><link rel="prefetch" href="/assets/js/45.4e6fb818.js"><link rel="prefetch" href="/assets/js/46.86268f46.js"><link rel="prefetch" href="/assets/js/47.84f7cda3.js"><link rel="prefetch" href="/assets/js/48.fd78be04.js"><link rel="prefetch" href="/assets/js/49.f5a6fc1e.js"><link rel="prefetch" href="/assets/js/5.892f2cf8.js"><link rel="prefetch" href="/assets/js/50.29919944.js"><link rel="prefetch" href="/assets/js/51.c1b5918c.js"><link rel="prefetch" href="/assets/js/52.c4ad64f8.js"><link rel="prefetch" href="/assets/js/53.df154372.js"><link rel="prefetch" href="/assets/js/54.4fee1b96.js"><link rel="prefetch" href="/assets/js/55.18c6e9f2.js"><link rel="prefetch" href="/assets/js/56.d5569485.js"><link rel="prefetch" href="/assets/js/57.9eb74b69.js"><link rel="prefetch" href="/assets/js/58.c8b7968e.js"><link rel="prefetch" href="/assets/js/59.a208d99c.js"><link rel="prefetch" href="/assets/js/6.a9a81823.js"><link rel="prefetch" href="/assets/js/60.c0f7048b.js"><link rel="prefetch" href="/assets/js/61.e06e2c12.js"><link rel="prefetch" href="/assets/js/62.3726a0b9.js"><link rel="prefetch" href="/assets/js/63.53a81692.js"><link rel="prefetch" href="/assets/js/64.ba6af384.js"><link rel="prefetch" href="/assets/js/65.2f165ffa.js"><link rel="prefetch" href="/assets/js/66.8c0a983a.js"><link rel="prefetch" href="/assets/js/67.74bf1c32.js"><link rel="prefetch" href="/assets/js/68.27c15e0b.js"><link rel="prefetch" href="/assets/js/69.5b78d6fb.js"><link rel="prefetch" href="/assets/js/7.a9e85c97.js"><link rel="prefetch" href="/assets/js/70.4772f9bd.js"><link rel="prefetch" href="/assets/js/71.2a2e89e4.js"><link rel="prefetch" href="/assets/js/72.3debedf0.js"><link rel="prefetch" href="/assets/js/73.c9ee93ce.js"><link rel="prefetch" href="/assets/js/74.7ec9495c.js"><link rel="prefetch" href="/assets/js/75.8c828ff5.js"><link rel="prefetch" href="/assets/js/76.986dc0d7.js"><link rel="prefetch" href="/assets/js/77.7e7e3c8e.js"><link rel="prefetch" href="/assets/js/78.200d9828.js"><link rel="prefetch" href="/assets/js/79.ee6b28e9.js"><link rel="prefetch" href="/assets/js/8.448002b9.js"><link rel="prefetch" href="/assets/js/80.93d03d67.js"><link rel="prefetch" href="/assets/js/81.eebcba15.js"><link rel="prefetch" href="/assets/js/82.3b0bb838.js"><link rel="prefetch" href="/assets/js/83.75234d18.js"><link rel="prefetch" href="/assets/js/84.1a897e55.js"><link rel="prefetch" href="/assets/js/85.8267b168.js"><link rel="prefetch" href="/assets/js/86.a7557c20.js"><link rel="prefetch" href="/assets/js/87.4f7e77b3.js"><link rel="prefetch" href="/assets/js/88.9b41f10e.js"><link rel="prefetch" href="/assets/js/89.662b9425.js"><link rel="prefetch" href="/assets/js/9.804860d0.js"><link rel="prefetch" href="/assets/js/90.6d84e2d8.js"><link rel="prefetch" href="/assets/js/91.650a7b6f.js"><link rel="prefetch" href="/assets/js/92.8568032c.js"><link rel="prefetch" href="/assets/js/93.0c300b40.js"><link rel="prefetch" href="/assets/js/94.f7ce23ff.js"><link rel="prefetch" href="/assets/js/95.e6c8272f.js"><link rel="prefetch" href="/assets/js/96.8f51c3ac.js"><link rel="prefetch" href="/assets/js/97.9cc683f5.js"><link rel="prefetch" href="/assets/js/98.6af1269f.js"><link rel="prefetch" href="/assets/js/99.97a09de8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8d0645b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="码农机器人" class="logo"> <span class="site-name can-hide">码农机器人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  react
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>建立前端知识体系</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>提效赋能 前端工程化篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>程序员PLUS篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/webpacks/webpack.html" aria-current="page" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#项目初始化" class="sidebar-link">项目初始化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#webpack-config-js" class="sidebar-link">webpack.config.js</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#package-json" class="sidebar-link">package.json</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#数据分析" class="sidebar-link">数据分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#日志美化" class="sidebar-link">日志美化</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#速度分析" class="sidebar-link">速度分析</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#文件体积监控" class="sidebar-link">文件体积监控</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#编译时间优化" class="sidebar-link">编译时间优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#缩小查找范围" class="sidebar-link">缩小查找范围</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#noparse" class="sidebar-link">noParse</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#ignoreplugin" class="sidebar-link">IgnorePlugin</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#thread-loader-多进程" class="sidebar-link">thread-loader(多进程)</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#利用缓存" class="sidebar-link">利用缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#编译体积优化" class="sidebar-link">编译体积优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#压缩js-css-html和图片" class="sidebar-link">压缩JS，CSS，HTML和图片</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#清除无用的css" class="sidebar-link">清除无用的CSS</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#tree-shaking" class="sidebar-link">Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#scope-hoisting" class="sidebar-link">Scope Hoisting</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#运行速度优化" class="sidebar-link">运行速度优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#代码分割" class="sidebar-link">代码分割</a></li></ul></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#环境" class="sidebar-link">环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#模式-mode" class="sidebar-link">模式(mode)</a></li><li class="sidebar-sub-header"><a href="/note/webpacks/webpack.html#javascript兼容性" class="sidebar-link">JavaScript兼容性</a></li></ul></li></ul></li><li><a href="/note/webpacks/webpack运行流程.html" class="sidebar-link">webpack运行流程</a></li><li><a href="/note/webpacks/webpack从入门到精通一.html" class="sidebar-link">webpack从入门到精通(一)</a></li><li><a href="/note/webpacks/webpack从入门到精通二.html" class="sidebar-link">webpack从入门到精通(二)</a></li><li><a href="/note/webpacks/webpack从入门到精通三.html" class="sidebar-link">webpack从入门到精通(三)</a></li><li><a href="/note/webpacks/webpack从入门到精通四.html" class="sidebar-link">webpack从入门到精通(四)</a></li><li><a href="/note/webpacks/webpack从入门到精通四.html" class="sidebar-link">webpack从入门到精通(四)</a></li><li><a href="/note/webpacks/webpack4源码.html" class="sidebar-link">webpack4源码</a></li><li><a href="/note/webpacks/手写简易webpack.html" class="sidebar-link">手写简易webpack</a></li><li><a href="/note/webpacks/webpack性能优化.html" class="sidebar-link">webpack性能优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>知识点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>忍者秘籍书</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h1> <h2 id="项目初始化"><a href="#项目初始化" class="header-anchor">#</a> 项目初始化</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm init <span class="token operator">-</span>y
npm install webpack webpack<span class="token operator">-</span>cli html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server cross<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h3 id="webpack-config-js"><a href="#webpack-config-js" class="header-anchor">#</a> webpack.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span><span class="token comment">//配置的模式</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span><span class="token comment">//调试工具的选择</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//上下文目录</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//输出得路径</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span><span class="token comment">//输出得文件名</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="数据分析"><a href="#数据分析" class="header-anchor">#</a> 数据分析</h2> <h3 id="日志美化"><a href="#日志美化" class="header-anchor">#</a> 日志美化</h3> <ul><li>friendly-errors-webpack-plugin可以识别某些类别得webpack错误，并清理，聚合和优先级，以提供更好得开发人员体验</li></ul> <h4 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin node<span class="token operator">-</span>notifier
</code></pre></div><h4 id="webpack-config-js-2"><a href="#webpack-config-js-2" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> FriendlyErrorWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> notifier <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-notifier'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ICON</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'icon.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span><span class="token comment">//配置的模式</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span><span class="token comment">//调试工具的选择</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//上下文目录</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token function-variable function">onErrors</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">severity<span class="token punctuation">,</span>errors</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> error <span class="token operator">=</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                notifier<span class="token punctuation">.</span><span class="token function">notifier</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'webpack编译失败'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">message</span><span class="token operator">:</span>severity<span class="token operator">+</span><span class="token string">':'</span><span class="token operator">+</span>error<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                    <span class="token literal-property property">subTitle</span><span class="token operator">:</span>error<span class="token punctuation">.</span>file<span class="token operator">||</span><span class="token string">''</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token constant">ICON</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="速度分析"><a href="#速度分析" class="header-anchor">#</a> 速度分析</h3> <ul><li>speed-measure-webpack5-plugin 可以分析打包速度</li></ul> <h4 id="安装-3"><a href="#安装-3" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install speed<span class="token operator">-</span>measure<span class="token operator">-</span>webpack5<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js-3"><a href="#webpack-config-js-3" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> SpeedMeasureWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'speed-measure-webpack5-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> smw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasureWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="文件体积监控"><a href="#文件体积监控" class="header-anchor">#</a> 文件体积监控</h3> <ul><li>webpack-bundle-analyzer 是一个webpack的插件，需要配合webpack和webpack-cli一起使用，这个插件功能是生成代码分析报告，帮助提升代码指令和网站性能</li> <li>它可以直观分析打包出得文件包含哪些，大小占比如何，模块包含关系，依赖项，文件是否重复，压缩后大小如何，针对这些，我们可以进行文件分割等操作</li></ul> <h4 id="安装-4"><a href="#安装-4" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js-4"><a href="#webpack-config-js-4" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>BundleAnalyzerPlugin<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//如果开启打包就启动HTTP服务器就不需要下面两个配置</span>
        <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">analyzerMode</span><span class="token operator">:</span><span class="token string">'disabled'</span><span class="token punctuation">,</span><span class="token comment">//不启动展示打包报告得HTTP服务器</span>
            <span class="token literal-property property">generateStatsFile</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//要生存stats.json文件</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/webpacks/1611653727254.jpg" alt=""></p> <h4 id="package-json-2"><a href="#package-json-2" class="header-anchor">#</a> package.json</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --progress&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-bundle-analyzer --port 8888 ./dist/stats.json&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="编译时间优化"><a href="#编译时间优化" class="header-anchor">#</a> 编译时间优化</h2> <ul><li>减少要处理的文件</li> <li>缩小查找的范围</li></ul> <h3 id="缩小查找范围"><a href="#缩小查找范围" class="header-anchor">#</a> 缩小查找范围</h3> <h4 id="extensions"><a href="#extensions" class="header-anchor">#</a> extensions</h4> <ul><li>指定extensions之后可以不用在<code>require</code>或是<code>import</code>的时候加文件扩展名</li> <li>查找得时候会依次尝试添加扩展名进行匹配</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span><span class="token string">'.jsx'</span><span class="token punctuation">,</span><span class="token string">'.json'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="alias"><a href="#alias" class="header-anchor">#</a> alias</h4> <ul><li>配置别名可以加快webpack查找模块得速度</li> <li>每当引入bootstrap模块的时候，它会直接引入<code>bootstrap</code>，而不需要从<code>node_modules</code>文件夹按模块的查找规则查找</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>npm install bootstrap css<span class="token operator">-</span>loader style<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> bootstrap <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'node_modules/bootstrap/dist/bootstrap.css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span><span class="token comment">//配置的模式</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span><span class="token comment">//调试工具的选择</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//上下文目录</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">main</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span><span class="token string">'.jsx'</span><span class="token punctuation">,</span><span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">alias</span><span class="token operator">:</span><span class="token punctuation">{</span>bootstrap<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'css-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="modules"><a href="#modules" class="header-anchor">#</a> modules</h4> <ul><li>对于直接声明依赖名的模块webpack会使用类似<code>Node.js</code>一样进行路径搜索，搜索<code>node_modules</code>目录</li> <li>如果可以确定想买内所有的第三方依赖模块都是在项目根目录下的<code>node_modules</code>中的话可以直接指定</li> <li>默认配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span><span class="token string">'.jsx'</span><span class="token punctuation">,</span><span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span><span class="token punctuation">{</span>bootstrap<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>直接指定  diff reslove:{}</li> <li>modules:{['C:/node_modules','node_modules']}</li></ul> <h4 id="mainfields"><a href="#mainfields" class="header-anchor">#</a> mainFields</h4> <ul><li>默认情况下<code>package.json</code>文件则按照文件中<code>main</code>字段的文件名来查找文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token comment">//配置target==='web'或者target==='webworker'时mainFields默认是:</span>
    <span class="token literal-property property">mainFields</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'browser'</span><span class="token punctuation">,</span><span class="token string">'module'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//target的值是其他时，mainFields默认值为:</span>
    <span class="token literal-property property">mainFields</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'module'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="oneof"><a href="#oneof" class="header-anchor">#</a> oneOf</h4> <ul><li>每个文件对于rules中的所有规则都会遍历一遍，如果使用oneOf就可以解决该问题，只要能匹配一个即可退出</li> <li>在oneOf中不能两个匹配处理同一种类型文件</li></ul> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">oneOf</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">include</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不解析node_modules</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                    <span class="token comment">//thread-loader开启线程池，开线程和线程通信都需要时间</span>
                    <span class="token punctuation">{</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'thread-loader'</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">workers</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
                    <span class="token punctuation">,</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">//启动babel缓存</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'css-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'less-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="external"><a href="#external" class="header-anchor">#</a> external</h4> <ul><li>如果我们想引用一个库，但是又不想让webpack打包，并且又不影响我们在程序中以CMD，AMD或者window/global全局等方式进行使用，那就可以配置externals</li></ul> <h5 id="安装-5"><a href="#安装-5" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install jquery html<span class="token operator">-</span>webpack<span class="token operator">-</span>externals<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="使用jquery"><a href="#使用jquery" class="header-anchor">#</a> 使用jquery</h5> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> jQuery <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> jQuery <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>index.html</strong></p> <p>src/index.html</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>sript src<span class="token operator">=</span><span class="token string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>sript<span class="token operator">&gt;</span>
</code></pre></div><h5 id="webpack-config-js-5"><a href="#webpack-config-js-5" class="header-anchor">#</a> webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">externals</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">jquery</span><span class="token operator">:</span><span class="token string">'jQuery'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="resolveloader"><a href="#resolveloader" class="header-anchor">#</a> resolveLoader</h4> <p><code>resolve.resolveLoader</code>用于配置解析loader时的resolve配置，默认的配置</p> <h5 id="logger-loader-js"><a href="#logger-loader-js" class="header-anchor">#</a> logger-loader.js</h5> <p>loaders/logger-loader.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//loader就是一个函数，接收一个内容，返回处理后的内容</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'@@@@@@@logger-loader@@@@@@@@@@'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre></div><h5 id="webpack-config-js-6"><a href="#webpack-config-js-6" class="header-anchor">#</a> webpack.config.js</h5> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loadersPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smw<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resolveLoader</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span><span class="token punctuation">[</span>loadersPath<span class="token punctuation">,</span><span class="token string">'node_modules'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">externals</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">jquery</span><span class="token operator">:</span><span class="token string">'jQuery'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="noparse"><a href="#noparse" class="header-anchor">#</a> noParse</h3> <ul><li><code>module.noParse</code>字段，可以用于配置哪些模块文件的内容不需要进行解析</li> <li>不需要解析依赖(即无依赖)的第三方大型类库等，可以通过这个字段来配置，以提高整体的构建速度</li> <li>使用<code>noParse</code>进行忽略的模块文件中不能使用<code>import</code>,<code>require</code>等语法</li></ul> <h4 id="src-index-js"><a href="#src-index-js" class="header-anchor">#</a> src/index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="src-title-js"><a href="#src-title-js" class="header-anchor">#</a> src/title.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre></div><h4 id="src-name-js"><a href="#src-name-js" class="header-anchor">#</a> src/name.js</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">'Roy'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="webpack-config-js-7"><a href="#webpack-config-js-7" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">noParse</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">title.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//正则表达式</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ignoreplugin"><a href="#ignoreplugin" class="header-anchor">#</a> IgnorePlugin</h3> <ul><li>ignore-plugin用于忽略某些特定的模块，让webpack不把这些指定的模块打包进去</li> <li>requestRegExp匹配(test)资源请求路径的正则表达式</li> <li>contextRegExp(可选)匹配(test)资源上下文(目录)的正则表达式</li> <li>moment会将所有本地化内容和核心功能一起打包，你可使用<code>ignorePlugin</code>,在打包时忽略本地化内容</li></ul> <h4 id="安装-6"><a href="#安装-6" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install moment <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><h4 id="src-index-js-2"><a href="#src-index-js-2" class="header-anchor">#</a> src/index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moment<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="webpack-config-js-8"><a href="#webpack-config-js-8" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">resourceRegexp</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//资源正则</span>
        <span class="token literal-property property">contextRegExp</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//上下文，目录正则</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="thread-loader-多进程"><a href="#thread-loader-多进程" class="header-anchor">#</a> thread-loader(多进程)</h3> <ul><li>把thread-loader放置在其他loader之前，放置在这个loader之后的loader就会在一个单独的worker池(worker pool)中运行</li> <li>include表示哪些目录中的<code>.js</code>文件需要进行<code>babel-loader</code></li> <li>exclude表示哪些目录中的<code>.js</code>文件不需要进行<code>babel-loader</code></li> <li>exclude的优先级高于include，尽量避免exclude，更倾向于使用include</li></ul> <h4 id="安装-7"><a href="#安装-7" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install thread<span class="token operator">-</span>loader babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="webpack-config-js-9"><a href="#webpack-config-js-9" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不解析node_modules</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token comment">//thread-loader开启线程池，开线程和线程通信都需要时间</span>
            <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'thread-loader'</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">workers</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token string">'logger-loader'</span><span class="token punctuation">,</span>
            <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
            <span class="token string">'css-loader'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="利用缓存"><a href="#利用缓存" class="header-anchor">#</a> 利用缓存</h3> <ul><li>利用缓存可以提升重复构建的速度</li></ul> <h4 id="babel-loader"><a href="#babel-loader" class="header-anchor">#</a> babel-loader</h4> <ul><li>Babel在转义js文件过程中消耗性能较高，将babel-loader执行的结果缓存起来，当重新打包构建时会尝试读取缓存，从而提高构建速度，降低消耗</li> <li>默认存放位置是<code>node_modules/.cache/babel-loader</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//不解析node_modules</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//thread-loader开启线程池，开线程和线程通信都需要时间</span>
        <span class="token punctuation">{</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'thread-loader'</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">workers</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">,</span><span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">//启动babel缓存</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="cache-loader"><a href="#cache-loader" class="header-anchor">#</a> cache-loader</h4> <ul><li>在一些性能开销较大的cache-loader之前添加此<code>loader</code>,可以将结果缓存在磁盘中</li> <li>默认保存在<code>node_modules/.cache/cache-loader</code>目录下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>npm install cache<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="hard-source-webpack-plugin"><a href="#hard-source-webpack-plugin" class="header-anchor">#</a> hard-source-webpack-plugin</h4> <ul><li>HardSourceWebpackPlugin为模块提供了中间缓存，缓存默认的存放路径是<code>node_modules/.cache/hard-source</code></li> <li>配置<code>hard-source-webpack-plugin</code>后，首次构建时间并不会有太大的变化，但是从第二次开始，构建时间大约可以减少80%左右</li> <li>webpack5中已经内置了模块缓存，不需要再使用此插件</li></ul> <h5 id="安装-8"><a href="#安装-8" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install hard<span class="token operator">-</span>source<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="webpack-config-js-10"><a href="#webpack-config-js-10" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token string">'cache-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'logger-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
        <span class="token string">'css-loader'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="webpack-config-js-11"><a href="#webpack-config-js-11" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> HardSourceWebpackPlugin<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hard-source-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="编译体积优化"><a href="#编译体积优化" class="header-anchor">#</a> 编译体积优化</h2> <h3 id="压缩js-css-html和图片"><a href="#压缩js-css-html和图片" class="header-anchor">#</a> 压缩JS，CSS，HTML和图片</h3> <ul><li>optimize-css-assets-webpack-plugin是一个优化和压缩CSS资源的插件</li> <li>terser-webpack-plugin是一个优化和压缩JS资源的插件</li> <li>image-webpack-loader可以帮助我们对图片进行压缩和优化</li></ul> <h5 id="安装-9"><a href="#安装-9" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin image<span class="token operator">-</span>webpack<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="webpack-config-js-12"><a href="#webpack-config-js-12" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MinCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'min-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">devtool</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">minimize</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minimizer</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpg|png|gif|bmp)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token literal-property property">mozjpeg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">progressive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">optipng</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">pngquant</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.65</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                    <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">4</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">gifsicle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">interlaced</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">webp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">75</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">minify</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">collapseWhitespace</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">removeComments</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//压缩CSS</span>

    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="清除无用的css"><a href="#清除无用的css" class="header-anchor">#</a> 清除无用的CSS</h3> <ul><li>purgecss-webpack-plugin 单独提取CSS并清除用不到的CSS</li></ul> <h4 id="安装-10"><a href="#安装-10" class="header-anchor">#</a> 安装</h4> <div class="language-js extra-class"><pre class="language-js"><code>npm install purgecss<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin mini<span class="token operator">-</span>css<span class="token operator">-</span>extract<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h4 id="src-index-js-3"><a href="#src-index-js-3" class="header-anchor">#</a> src/index.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'./index.css'</span>
</code></pre></div><h4 id="src-index-css"><a href="#src-index-css" class="header-anchor">#</a> src/index.css</h4> <div class="language-js extra-class"><pre class="language-js"><code>body<span class="token punctuation">{</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span>red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
#root<span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span>red
<span class="token punctuation">}</span>
#other<span class="token punctuation">{</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span>green
<span class="token punctuation">}</span>
</code></pre></div><h4 id="webpack-config-js-13"><a href="#webpack-config-js-13" class="header-anchor">#</a> webpack.config.js</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//因为CSS和JS的加载可以并行，所以我们可以通过此插件提取CSS成单独的文件，然后去掉无用的CSS并进行压缩</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> PurgecssWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'purgecss-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件匹配模式</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token constant">PATH</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">src</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span><span class="token punctuation">[</span>
                MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
                <span class="token string">'css-loader'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//**匹配任意字段，包括路径分隔符，*匹配任意自动，不包含路径分隔符</span>
        <span class="token keyword">new</span> <span class="token class-name">PurgecssWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">path</span><span class="token operator">:</span>glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PATH</span><span class="token punctuation">.</span>src<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">nodir</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> Tree Shaking</h3> <ul><li>一个模块可以有多个方法，只要其中某个方法使用到了，则整个文件都会被打到bundle里面去，tree shaking就是只把用到的方法打入bundle，没用到的方法会<code>uglify</code>阶段擦除掉</li> <li>原理是利用es6模块的特定，只能作为模块顶层语句出现，import的模块名只能是字符串常量</li></ul> <h4 id="开启"><a href="#开启" class="header-anchor">#</a> 开启</h4> <ul><li>webpack默认支持，可在production mode下默认开启</li> <li>在package.json 中配置:
<ul><li>&quot;sideEffects&quot;:false 所有的代码都没有副作用(都可以进行tree shaking)</li> <li>可能会把css和@babel/polyfill文件干掉 可以设置&quot;sideEffects&quot;:[&quot;*.css&quot;]</li></ul></li></ul> <h4 id="没有导入和使用"><a href="#没有导入和使用" class="header-anchor">#</a> 没有导入和使用</h4> <p>functions.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'func1'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'func2'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
    func1<span class="token punctuation">,</span>
    func2
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>func2<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./functions'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="代码不会被执行-不可到达"><a href="#代码不会被执行-不可到达" class="header-anchor">#</a> 代码不会被执行，不可到达</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="代码中只写不读的变量"><a href="#代码中只写不读的变量" class="header-anchor">#</a> 代码中只写不读的变量</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> aabbcc <span class="token operator">=</span> <span class="token string">'aabbcc'</span><span class="token punctuation">;</span>
aabbcc <span class="token operator">=</span> <span class="token string">'eeffgg'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="scope-hoisting"><a href="#scope-hoisting" class="header-anchor">#</a> Scope Hoisting</h3> <ul><li>Scope Hoisting 可以让webpack打包出来的代码文件更小，运行的更快，它又译作&quot;作用域提升&quot;，是在webpack3中新推出的功能</li> <li>scope hoisting 的愿你是讲所有的模块按照引用顺序放在一个函数作用域里，然后适当的重命名一些变量以防止命名冲突</li> <li>这个功能在mode为production下默认开启，开发环境要用<code>webpack.optimizeModuleConcatenationPlugin</code>插件</li></ul> <p>hello.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> str <span class="token keyword">from</span> <span class="token string">'./hello.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>main.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> hello <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'hello'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="运行速度优化"><a href="#运行速度优化" class="header-anchor">#</a> 运行速度优化</h2> <h3 id="代码分割"><a href="#代码分割" class="header-anchor">#</a> 代码分割</h3> <ul><li>对于大的web应用来讲，将所有的代码都放在一个文件中显然是不够有效的，特别是当你的某些代码块是在某些特殊的时候才会被用到</li> <li>webpack有一个功能就是将你的代码库分割成chunks语块，当代码运行到需要它们的时候进行加载</li></ul> <h4 id="入口点分割"><a href="#入口点分割" class="header-anchor">#</a> 入口点分割</h4> <ul><li>Entry Points:入口文件设置的时候可以配置</li> <li>这种方法的问题
<ul><li>如果入口chunks之间包含重复的模块(lodash)，那些重复模块都会被引入到各个bundle中</li> <li>不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//mpa多页应用</span>
<span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">login</span><span class="token operator">:</span><span class="token string">&quot;./src/login.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h4> <ul><li>用户当前需要用什么功能就只加载这个功能对应的代码，也就是所谓的按需加载，在给单页应用做按需加载优化时</li> <li>一般采用以下原则:
<ul><li>对网站功能进行划分，每一类一个chunk</li> <li>对于首次打开页面需要的功能直接加载，尽快展示给用户，某些依赖大量代码的功能点可以按需加载</li> <li>被分割出去的代码需要一个按需加载的时机</li></ul></li></ul> <h5 id="hello-js"><a href="#hello-js" class="header-anchor">#</a> hello.js</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="index-js"><a href="#index-js" class="header-anchor">#</a> index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//渲染首页得时候先不加载hello模块，等当点击按钮得时候，才去服务器动态加载hello模块</span>
<span class="token comment">//import语法 vue react angular的懒加载组件原理是一样得</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#clickBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//import语句是一个天然得代码分割点。如果遇到import就会分割了去一个单独得代码块，可以单独加载</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h5 id="index-html"><a href="#index-html" class="header-anchor">#</a> index.html</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;clickBtn&quot;</span><span class="token operator">&gt;</span>点我<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre></div><h4 id="prefetch"><a href="#prefetch" class="header-anchor">#</a> prefetch</h4> <ul><li>使用预先拉取，你表示改模块可能以后会用到。浏览器会在空闲事件下载该模块</li> <li>prefetch得作用是告诉浏览器未来可能会使用到的某个资源，浏览器就会在闲时去加载对应的资源，若能预测到用户的行为，比如懒加载，点击到其他页面等则相当于提前预加载了需要的资源</li> <li>此导入会让<code>&lt;link rel=&quot;prefetch&quot; as=&quot;script&quot; href=&quot;http://localhost:8080/hello.js&quot;&gt;</code>被添加直页面的头部，因此浏览器会在空闲时预先拉取该文件</li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#clickBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName:'hello',webpackPrefetch:true*/</span><span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">preload与prefetch区别</p> <p>preload:预加载,此资源肯定会用到，优先较高，需要提前获取。它要慎用，有可能有性能隐患</p> <p>prefetch:预获取，此资源在以后可能会用到，它是在浏览器空闲的时候加载，没有性能问题</p></div> <h4 id="提取公共代码"><a href="#提取公共代码" class="header-anchor">#</a> 提取公共代码</h4> <ul><li>怎么配置单页应用？怎么配置多页应用？</li></ul> <h5 id="为什么需要提取公共代码"><a href="#为什么需要提取公共代码" class="header-anchor">#</a> 为什么需要提取公共代码</h5> <ul><li>大网站有多个页面，每个页面由于采用相同技术栈，会包含很多公共代码,如果都包含进来还会有问题</li> <li>相同的资源被重复的加载，浪费用户的流量和服务器的成本</li> <li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验</li> <li>如果能把公共代码抽离成单独文件进行加载能进行优化，可以减少网络传输流量，降低服务器成本</li></ul> <h5 id="如何提取"><a href="#如何提取" class="header-anchor">#</a> 如何提取</h5> <ul><li>基础类库，方便长期缓存</li> <li>页面之间的公用代码</li> <li>各个页面单独生成文件</li></ul> <h5 id="splitchunks"><a href="#splitchunks" class="header-anchor">#</a> splitChunks</h5> <ul><li>split-chunks-plugin</li></ul> <h5 id="module-chunk-bundle"><a href="#module-chunk-bundle" class="header-anchor">#</a> module chunk bundle</h5> <ul><li>module:就是js的模块化webpack支持commonJS，ES6等模块化规范，简单来说就是你通过import语句引入的代码</li> <li>chunk:chunk是webpack根据功能拆分出来的，包含三种情况
<ul><li>你得项目入口(entry)</li> <li>通过import()动态引入的代码</li> <li>通过splitChunks拆分出来的代码</li></ul></li> <li>bundle:bundle是webpack打包之后的各个文件，一般就是和chunk是一对一的关系，bundle就是兑chunk进行编译压缩打包等处理之后的产出</li></ul> <p><img src="/webpacks/1611731367206.jpg" alt=""></p> <p><strong>page1.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module1'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">'./module2'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">,</span>module2<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'asyncModule1'*/</span><span class="token string">'./asyncModule1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>page2.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module1'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">'./module2'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">,</span>module2<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>page3.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> module1 <span class="token keyword">from</span> <span class="token string">'./module1'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> module2 <span class="token keyword">from</span> <span class="token string">'./module3'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">,</span>module3<span class="token punctuation">,</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>module1.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'module1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>module2.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>module3.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'module3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">page1</span><span class="token operator">:</span><span class="token string">'./src/page1.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">page2</span><span class="token operator">:</span><span class="token string">'./src/page2.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">page3</span><span class="token operator">:</span><span class="token string">'./src/page3.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//initial 入口chunk，对于异步导入的文件不处理</span>
        <span class="token comment">// async 异步chunk，只对异步导入的文件处理</span>
        <span class="token comment">// all 全部chunk</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span><span class="token comment">//默认只分割异步模块</span>
        <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//分割出去的代码块的最小体积，0表示不限制</span>
        <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//分割出去的代码块的最大体积，0表示不限制</span>
        <span class="token literal-property property">minRemainingSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//分割后剩下体积 0表示不限制 webpack5新添的参数</span>
        <span class="token comment">//minChunks: 1,//如果此模块被多个入口引用几次会被分割</span>
        <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">//异步请求最大分割出去几个代码块</span>
        <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">//同步时最大分割出去几个代码块</span>
        <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span><span class="token comment">//名称的分隔符</span>
        <span class="token literal-property property">enforceSizeThreshold</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span><span class="token comment">//强制阈值 新增加的参数</span>
        <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//缓存组配置 配置如何对模块分组相同分组会分到一个代码块中</span>
            <span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">//第三方模块</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span><span class="token comment">//如果模块的路径匹配此正则的话</span>
                <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">//很多缓存组，如果一个模块同属于多个缓存组，应该分到哪个组里，看优先级高</span>
                <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token comment">//是否可复用现有的代码块</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//此模块最几个入口引用过,最少2个才取提取</span>
                <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'page1.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'page1'</span><span class="token punctuation">]</span><span class="token comment">//往HTML页面里播放哪些资源文件(bundle)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'page2.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'page2'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'page3.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">chunks</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'page3'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="环境"><a href="#环境" class="header-anchor">#</a> 环境</h2> <h3 id="模式-mode"><a href="#模式-mode" class="header-anchor">#</a> 模式(mode)</h3> <ul><li>日常的前端开发工作中，一般都会又两套构建环境</li> <li>一套开发时使用，构建结果用于本地开发调试，不进行代码压缩，打印debug信息，包含sourcemap文件</li> <li>一套构建后的结果是直接应用于线上的，即代码都是压缩后，运行时不打印debug信息，静态文件不包括sourcemap</li> <li>webpack 4.x引入了mode的概念</li> <li>当你指定使用production mode时，默认会启用各种性能优化的功能，包括构建结果优化以及webpack运行性能优化</li> <li>而如果时development mode的话，则会开启debug工具，运行时打印详细的错误信息，以及更加快读的增量编译构建</li></ul> <table><thead><tr><th>构建</th> <th>描述</th></tr></thead> <tbody><tr><td>development</td> <td>会讲process.env.NODE_ENV的值设为development,启用NamedChunksPlugin和NamedModulesPlugin</td></tr> <tr><td>production</td> <td>会讲process.env.NODE_ENV的值设置为production，启用FlagDependencyUsagePlugin,FlagIncludedChunksPlugin,ModuleConcatenationPlugin,NoEmitOnErrorsPlugin,OccurrenceOrderPlugin,SideEffectsFlagPlugin和UglifyJsPlugin</td></tr></tbody></table> <h4 id="环境差异"><a href="#环境差异" class="header-anchor">#</a> 环境差异</h4> <ul><li>开发环境
<ul><li>需要生成sourcemap文件</li> <li>需要打印debug信息</li> <li>需要live reload或者hot reload的功能</li></ul></li> <li>生产环境
<ul><li>可能需要分离CSS成单独的文件，以便多个页面共享同一个CSS文件</li> <li>需要压缩HTML/CSS/JS代码</li> <li>需要压缩图片</li></ul></li> <li>其默认值为production</li></ul> <h4 id="区分环境"><a href="#区分环境" class="header-anchor">#</a> 区分环境</h4> <ul><li>--mode 用来设置模块内的process.env.NODE_ENV</li> <li>--env 用来设置webpack配置文件的函数参数</li> <li>cross-env用来设置node环境的process.env.NODE_ENV</li> <li>dotenv可以按需加载不同的环境变量文件</li> <li>define-plugin用来配置在 <strong>编译时候</strong> 用的 <strong>全局常量</strong></li></ul> <h5 id="安装-11"><a href="#安装-11" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install cross<span class="token operator">-</span>env dotenv terser<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin optimize<span class="token operator">-</span>css<span class="token operator">-</span>assets<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="mode默认值"><a href="#mode默认值" class="header-anchor">#</a> mode默认值</h5> <ul><li>webpack的mode默认为production</li> <li>webpack serve 的mode默认为development</li> <li>可以在模块内通过process.env.NODE_ENV获取当前的环境变量，无法在webpack配置文件中获取此变量</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token comment">//development | production</span>
</code></pre></div><h5 id="命令行传mode"><a href="#命令行传mode" class="header-anchor">#</a> 命令行传mode</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="命令行配置env"><a href="#命令行配置env" class="header-anchor">#</a> 命令行配置env</h5> <ul><li>无法在模块内通过process.env.NODE_ENV访问</li> <li>可以通过webpack配置文件中通过函数获取当前环境变量</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=production&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development serve&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token comment">//undefined</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">optimization</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">minimize</span><span class="token operator">:</span>env<span class="token operator">&amp;&amp;</span>env<span class="token punctuation">.</span>production<span class="token punctuation">,</span>
            <span class="token literal-property property">minimizer</span><span class="token operator">:</span><span class="token punctuation">(</span>env<span class="token operator">&amp;&amp;</span>env<span class="token punctuation">.</span>production<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">parallel</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//开启多进程并行压缩</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="mode配置"><a href="#mode配置" class="header-anchor">#</a> mode配置</h5> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="defineplugin"><a href="#defineplugin" class="header-anchor">#</a> DefinePlugin</h5> <ul><li>设置全局变量(不是<code>window</code>)，所有模块都能读取到该变量的值</li> <li>可以在任意模块内通过<code>process.env.NODE_ENV</code>获取当前的环境变量</li> <li>但无法在<code>node环境</code>(wenpack配置文件中)下获取当前的环境变量</li></ul> <p><strong>webpack.config.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'process.env.NODE_ENV'</span><span class="token punctuation">,</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NODE_ENV'</span><span class="token punctuation">,</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//error</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token comment">//定义在编译使用的全局变量，在浏览器运行阶段就只是值了</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string-property property">&quot;process.env.NODE_ENV&quot;</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//注意用双引号引起了，否则就变成变量了</span>
            <span class="token string-property property">&quot;NODE_ENV&quot;</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">NODE</span><span class="token punctuation">.</span><span class="token constant">ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//production</span>
</code></pre></div><p><strong>src/logger.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">==</span> <span class="token string">'development'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="cross-env"><a href="#cross-env" class="header-anchor">#</a> cross-env</h5> <p>.env</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">NODE_ENV</span><span class="token operator">=</span>development
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//可以读取.env文件，获取里面的值，设置到process.env.NODE_ENV里面</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'webpack.config.js process.env.NODE_ENV'</span><span class="token punctuation">,</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="javascript兼容性"><a href="#javascript兼容性" class="header-anchor">#</a> JavaScript兼容性</h3> <h4 id="babel"><a href="#babel" class="header-anchor">#</a> Babel</h4> <ul><li>Babel是一个JavaScript编译器</li> <li>Babel是一个工具链，主要用于讲ECMAScript 2015+版本的代码转换为向后兼容的JavaScript语法，以便能够运行在当前和旧版本的浏览器或其他环境中</li> <li>Babel能为你做的事
<ul><li>语法转换</li></ul></li></ul> <h5 id="安装-12"><a href="#安装-12" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>cli <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="命令行使用"><a href="#命令行使用" class="header-anchor">#</a> 命令行使用</h5> <p><strong>src/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>a<span class="token operator">+</span>b<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>package.json</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h4> <ul><li>Babel是一个编译器(输入源码=&gt;输出编译后的代码)。就像其他编译器一样，编译过程分为三个阶段:解析、转换和打印输出</li> <li>现在，Babel虽然开箱即用，但是什么动作都不做，它基本上类似于<code>const babel=code=&gt;code;</code>，讲代码解析之后在输出同样的代码。如果想要Babel做一些实际的工作，就需要其添加插件。</li></ul> <h5 id="安装-13"><a href="#安装-13" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>arrow<span class="token operator">-</span>functions <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="babelrc"><a href="#babelrc" class="header-anchor">#</a> .babelrc</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-transform-arrow-functions&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="预设"><a href="#预设" class="header-anchor">#</a> 预设</h4> <ul><li>@babel/preset-env可以让你使用最新的JavaScript语法，而不需要去管理语法转换器(并且可选的支持目标浏览器环境的polyfills)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;pluginA&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pluginB&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pluginC&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="安装-14"><a href="#安装-14" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env
</code></pre></div><h5 id="babelrc-2"><a href="#babelrc-2" class="header-anchor">#</a> .babelrc</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="browsers"><a href="#browsers" class="header-anchor">#</a> browsers</h5> <ul><li>@babel/preset-env会根据你配置的目标环境，生成插件列表来编译</li> <li>可以使用.browserslistrc 文件来指定目标环境</li> <li>browserslist详细配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//.browserslistrc</span>
<span class="token operator">&gt;</span><span class="token number">0.25</span><span class="token operator">%</span>
not head
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>last <span class="token number">2</span> Chrome versions
</code></pre></div><h4 id="polifill"><a href="#polifill" class="header-anchor">#</a> polifill</h4> <ul><li>@babel/preset-env默认只转换新的JavaScript语法，而不转换新的API，比如 Iterator,Generator,Set,Maps,Proxy,Reflect,Symbol,Promise等全局对象。以及一些在全局对象上的方法(比如Object.assign)都不会转码</li> <li>比如说，ES6在Array对象上新增了Array.from方法，Babel就不会转码这个方法，如果想让这个方法运行，必须使用babel-polyfill来转换等。</li> <li>polyfill的中文意思是垫片，所谓垫片不同浏览器或者不同环境下的差异，让新的内置函数，实例方法等在低版本浏览器中也可以使用</li> <li>官方给出@babel/polyfill和babel-runtime两种解决方案来解决这种全局对象或全局对象方法不足的问题</li> <li>babel-runtime适合在组件和类库项目中使用，而babel-polyfill适合在业务项目中使用</li></ul> <h5 id="polyfill"><a href="#polyfill" class="header-anchor">#</a> polyfill</h5> <ul><li>@babel/polyfill模块可以模拟完整的ES2015+环境</li> <li>这意味着可以使用诸如Promise和WeakMap之类的新的内置对象，Array.from或Object.assign之类的静态方法，Array.prototype.includes之类的实例方法以及生成器函数</li> <li>它是通过向全局对象和内置对象的prototype上添加方法来实现的。比如运行环境中不支持Array.prototype.find方法，引入polyfill，我们就可以使用es6方法来编写了，但是缺点就是会造成全局空间污染</li> <li>V7.4.0版本开始,@babel/polyfill已经被废弃</li></ul> <h5 id="安装-15"><a href="#安装-15" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">--</span>save @babel<span class="token operator">/</span>polyfill core<span class="token operator">-</span>js@<span class="token number">3</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli babel<span class="token operator">-</span>loader
</code></pre></div><h5 id="usebuiltins-fase"><a href="#usebuiltins-fase" class="header-anchor">#</a> useBuiltIns:fase</h5> <ul><li>&quot;useBuiltIns:false&quot;此时不对polyfill做操做。如果引入@babel/polyfill,则无视配置的浏览器兼容,引入所有的polyfill</li></ul> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@babel/polyfill&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mode</span><span class="token operator">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//输出的路径</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span><span class="token string">'[name].js'</span><span class="token comment">//输出的文件名</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token boolean">false</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>package.json</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist --watch&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;pack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --mode=development&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="usebuiltins-entry"><a href="#usebuiltins-entry" class="header-anchor">#</a> useBuiltIns:entry</h5> <ul><li>&quot;useBuiltIns&quot;:&quot;entry&quot;根据配置的浏览器兼容，引入浏览器不兼容的polyfill。需要在入口文件手动添加<code>import '@babel/polyfill'</code>，会自动根据browserslist替换成浏览器不兼容的所有polyfill</li> <li>这里需要指定core-js的版本，如果&quot;corejs&quot;:3,则<code>import '@babel/polyfill'</code>需要改成<code>import 'core-js';import 'regenerator-runtime/runtime'</code></li> <li><code>core-js@2</code>分支中已经不会在添加新特性，新特性都会添加到<code>core-js@3</code>，比如<code>Array.prototype.flat()</code></li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">'entry'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token string">&quot;last 2 Chrome versions&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">'core-js/stable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'regenerator-runtime/runtime'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="usebuiltins-usage"><a href="#usebuiltins-usage" class="header-anchor">#</a> useBuiltIns:usage</h5> <ul><li>&quot;useBuiltIns&quot;:&quot;usage&quot; usage会根据配置的浏览器兼容，以及你代码中用到的API来进行polyfill，实现了按需添加</li></ul> <p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">'usage'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token string">&quot;&gt;0.25%,not dead&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>dist/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'core-js/stable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'regenerator-runtime/runtime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token operator">=&gt;</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="babel-runtime"><a href="#babel-runtime" class="header-anchor">#</a> babel-runtime</h4> <ul><li>Babel为了解决全局空间污染问题，提供了单独的包babel-runtime用以提供编译模块的工具函数</li> <li>简单的说<code>babel-runtime</code>更像是一种按需加载的实现，比如你哪里需要使用Promise，只要在这个文件头部<code>require Promise from 'bable-runtime/core-js/promise'</code>就行了</li></ul> <h5 id="安装-16"><a href="#安装-16" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install babel<span class="token operator">-</span>runtime <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="src-index-js-4"><a href="#src-index-js-4" class="header-anchor">#</a> src/index.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Promise <span class="token keyword">from</span> <span class="token string">'babel-runtime/core-js/promise'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="webpack-config-js-14"><a href="#webpack-config-js-14" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="header-anchor">#</a> babel-plugin-transform-runtime</h4> <ul><li>启用插件<code>babel-plugin-transform-runtime</code>后，Babel就会使用<code>babel-runtime</code>下的工具函数</li> <li><code>babel-plugin-transform-runtime</code>插件能够将这些工具函数的代码转换成<code>require</code>语句,指向为对<code>babel-runtime</code>的引用</li> <li><code>babel-plugin-transform-runtime</code>就是可以在我们使用新API时自动<code>import babel-runtime</code>里面的polyfill
<ul><li>当我们使用async/await时，自动引入<code>babel-runtime/regenerator</code></li> <li>当我们使用ES6的静态事件或内置对象时，自动引入<code>babel-runtime/core-js</code></li> <li>移除内联<code>babel helpers</code>并替换使用<code>babel-runtime/helpers</code>来替换</li></ul></li> <li><code>babel-plugin-transform-runtime</code>自带的是<code>core-js@3</code>，如果配置corejs配置为2需要单独安装<code>@babel/runtime-corejs2</code></li> <li><code>@babel/polyfill</code>自带的<code>core-js@2</code>，如果配置corejs配置为3，需要单独安装<code>core-js@3</code></li> <li><code>@babel/plugin-transform-runtime</code>可以减少编译后代码的提交外，我们使用它还有一个好处，它可以为代码创建一个沙盒环境，如果使用<code>@babel/polyfill</code>及其提供的内置程序(例如Promise，Set和Map)，则它们将污染全局范围，虽然这对于应用程序或命令行工具可能时可以的，但是如果你得代码是要发布供其他人使用的库，或者无法完全控制代码运行的环境，则将成为一个问题</li></ul> <h5 id="安装-17"><a href="#安装-17" class="header-anchor">#</a> 安装</h5> <div class="language-js extra-class"><pre class="language-js"><code>npm install @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>transform<span class="token operator">-</span>runtime @babel<span class="token operator">/</span>runtime<span class="token operator">-</span>corejs2 @babel<span class="token operator">/</span>runtime<span class="token operator">-</span>corejs3 <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h5 id="webpack-config-js-15"><a href="#webpack-config-js-15" class="header-anchor">#</a> webpack.config.js</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span><span class="token string">'usage'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token string">&quot;&gt;0.25%,not dead&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">]</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{</span>
                                <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//当我们使用ES6的静态事件或内置对象时自动引入babel-runtime/core-js</span>
                                <span class="token literal-property property">helpers</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//移除内联babel helpers并替换使用babel-runtime/helpers来替换</span>
                                <span class="token literal-property property">regenerator</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//是否开启regenerator函数转换或使用regenerator runtime来避免污染全局域</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-decorators'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">legacy</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">loose</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>src/index.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//corejs</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//helpers</span>
<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token comment">//regenerator</span>
<span class="token keyword">function</span><span class="token operator">*</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="执行顺序"><a href="#执行顺序" class="header-anchor">#</a> 执行顺序</h5> <ul><li>插件在Presets前运行</li> <li>插件属性从前往后排列</li> <li>presets顺序从后往前</li></ul> <p>webpack.config.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin1 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'plugins'</span><span class="token punctuation">,</span> <span class="token string">'plugin1.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin2 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'plugins'</span><span class="token punctuation">,</span> <span class="token string">'plugin2.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin3 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'plugins'</span><span class="token punctuation">,</span> <span class="token string">'plugin3.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin4 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'plugins'</span><span class="token punctuation">,</span> <span class="token string">'plugin4.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin5 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'plugins'</span><span class="token punctuation">,</span> <span class="token string">'plugin5.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugin6 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'plugins'</span><span class="token punctuation">,</span> <span class="token string">'plugin6.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">preset1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span>  <span class="token punctuation">{</span> <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin5<span class="token punctuation">,</span>plugin6<span class="token punctuation">]</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">preset2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span>  <span class="token punctuation">{</span> <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin3<span class="token punctuation">,</span>plugin4<span class="token punctuation">]</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token comment">//plugins: [plugin1,plugin2],</span>
<span class="token comment">//presets: [preset1,preset2]</span>
<span class="token comment">//插件先执行预设后执行</span>
<span class="token comment">//插件是从前往后</span>
<span class="token comment">//预设是从后往前</span>
<span class="token comment">//plugin1,plugin2 plugin3,plugin4 plugin5,plugin6</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin1<span class="token punctuation">,</span>plugin2<span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>preset1<span class="token punctuation">,</span>preset2<span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/25/2021, 3:56:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/http/http基础.html" class="prev">
        http 基础
      </a></span> <span class="next"><a href="/note/webpacks/webpack运行流程.html">
        webpack运行流程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.61a85b1c.js" defer></script><script src="/assets/js/2.6b359b12.js" defer></script><script src="/assets/js/105.5429d9b6.js" defer></script>
  </body>
</html>
