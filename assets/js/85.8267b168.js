(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{387:function(t,e,r){"use strict";r.r(e);var a=r(12),s=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"用rail模型分析性能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用rail模型分析性能"}},[t._v("#")]),t._v(" 用RAIL模型分析性能")]),t._v(" "),e("p",[t._v("RAIL是一个以用户为中心的性能模型，它把用户的体验拆分成几个关键点(例如，tap,scroll,load)，并且帮你定义好了每一个的性能指标。")]),t._v(" "),e("ul",[e("li",[t._v("R:Response响应")]),t._v(" "),e("li",[t._v("A:Animation动画")]),t._v(" "),e("li",[t._v("I:Idle空闲")]),t._v(" "),e("li",[t._v("L:Load加载")])]),t._v(" "),e("p",[e("img",{attrs:{src:"/optimization/OTRlZTdhYWYyYjY.png",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"聚焦用户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#聚焦用户"}},[t._v("#")]),t._v(" 聚焦用户")]),t._v(" "),e("p",[t._v("一下是用户对性能延迟的感知:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("延迟时间")]),t._v(" "),e("th",[t._v("用户感知")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("0-16ms")]),t._v(" "),e("td",[t._v("很流畅")])]),t._v(" "),e("tr",[e("td",[t._v("0-100ms")]),t._v(" "),e("td",[t._v("基本流畅")])]),t._v(" "),e("tr",[e("td",[t._v("100-1000ms")]),t._v(" "),e("td",[t._v("感觉到网站上有一些加载任务")])]),t._v(" "),e("tr",[e("td",[t._v("1000ms or more")]),t._v(" "),e("td",[t._v("失去耐心了")])]),t._v(" "),e("tr",[e("td",[t._v("10000ms or more")]),t._v(" "),e("td",[t._v("直接离开，不会再访问了")])])])]),t._v(" "),e("h2",{attrs:{id:"response-事件处理最好在50ms内完成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#response-事件处理最好在50ms内完成"}},[t._v("#")]),t._v(" Response:事件处理最好在50ms内完成")]),t._v(" "),e("h3",{attrs:{id:"目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),e("p",[t._v("用户的输入到响应的时间不超过100ms，给用户的感受是瞬间就完成了。")]),t._v(" "),e("h3",{attrs:{id:"优化方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化方案"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),e("ul",[e("li",[t._v("事件处理函数在50ms内完成，考虑到idle task的情况，事件会排队，等待时间大概在50ms。适用于click，toggle，starting animations等，不适用于drag和scroll。")]),t._v(" "),e("li",[t._v("复杂的js计算尽可能放在后台，如web worker，避免对用户输入造成阻塞")]),t._v(" "),e("li",[t._v("超过50ms的响应，一定要提供反馈，比如倒计时，进行百分比等。")])]),t._v(" "),e("blockquote",[e("p",[t._v("idle task:除了要处理输入事件，浏览器还有其他任务要做，这些任务会占用部分时间，一般情况会花费50ms的时间，输入事件的响应则排在其后。")])]),t._v(" "),e("p",[t._v("下图是idle task对input response的影响:")]),t._v(" "),e("p",[e("img",{attrs:{src:"/optimization/aHR0cHM6Ly91c2Vy.png",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"animation-在10ms内产生一帧"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#animation-在10ms内产生一帧"}},[t._v("#")]),t._v(" Animation:在10ms内产生一帧")]),t._v(" "),e("h3",{attrs:{id:"目标-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目标-2"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),e("ul",[e("li",[t._v("产生每一帧的时间不要超过10ms，为了保证浏览器60帧，每一帧的时间在16ms左右，但浏览器需要用6ms来渲染每一帧。")]),t._v(" "),e("li",[t._v("旨在视觉上的平滑。用户对帧率变化感知很敏感。")])]),t._v(" "),e("h3",{attrs:{id:"优化方案-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化方案-2"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),e("ul",[e("li",[t._v("在一些高压点上，比如动画，不要去挑战CPU，尽可能的少做事，如:取offset，设置style等操作。尽可能的保证60帧的体验。")]),t._v(" "),e("li",[t._v("在渲染性能上，针对不同的动画做一些特定优化。")])]),t._v(" "),e("blockquote",[e("p",[t._v("动画不只是UI的视觉效果，一下行为都属于:")]),t._v(" "),e("ul",[e("li",[t._v("视觉动画，如渐隐渐现，tweens，loading等")]),t._v(" "),e("li",[t._v("滚动，包含弹性滚动，松开手指后，滚动会持续一段距离")]),t._v(" "),e("li",[t._v("拖拽，缩放，经常伴随着用户行为")])])]),t._v(" "),e("h2",{attrs:{id:"idle-最大化空闲时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#idle-最大化空闲时间"}},[t._v("#")]),t._v(" Idle:最大化空闲时间")]),t._v(" "),e("h3",{attrs:{id:"目标-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目标-3"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),e("p",[t._v("最大化空闲时间，以增大50ms内响应用户输入的几率")]),t._v(" "),e("h3",{attrs:{id:"优化方案-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化方案-3"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("用空闲时间来完成一些延后的工作，如先加载页面可见部分，然后利用空闲时间加载剩余部分，此处可以使用"),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback",target:"_blank",rel:"noopener noreferrer"}},[t._v("requestIdleCallback API"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("在空闲时间内执行的任务尽量控制在50ms以内，如果更长的话，会影响input handle的pending时间")])]),t._v(" "),e("li",[e("p",[t._v("如果用户在空闲时间任务进行时进行交互，必须以此为最高优先级，并暂时空闲时间的任务")])])]),t._v(" "),e("h2",{attrs:{id:"load-传输内容到页面可交互的时间不超过5秒"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#load-传输内容到页面可交互的时间不超过5秒"}},[t._v("#")]),t._v(" Load:传输内容到页面可交互的时间不超过5秒")]),t._v(" "),e("p",[t._v("如果页面加载比较慢，用户的交点可能会离开。加载很快的页面，用户平均停留时间会变成，跳出率会更低，也就有更高的广告查看率")]),t._v(" "),e("h3",{attrs:{id:"目标-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目标-4"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),e("ul",[e("li",[t._v("优化加载速度，可以根据设备，网络等条件。目前，比较好的一个方式是，让你的页面在一个中配的3G网络手机上打开时间不超过5秒")]),t._v(" "),e("li",[t._v("对于第二次打开，尽量不超过2秒")])]),t._v(" "),e("h3",{attrs:{id:"优化方案-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化方案-4"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),e("ul",[e("li",[t._v("在手机设备上测试加载性能，选用中配的3G网络(400kb/s,400ms RTT)，可以使用"),e("a",{attrs:{href:"https://www.webpagetest.org/easy",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebPageTest"),e("OutboundLink")],1),t._v("来测试")]),t._v(" "),e("li",[t._v("要注意的是，即使用户的网络是4G，但因为丢包或者网络波动，可能会比预期的更慢")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://web.dev/render-blocking-resources/",target:"_blank",rel:"noopener noreferrer"}},[t._v("禁用渲染阻塞的资源，延后加载"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("可以采用 "),e("a",{attrs:{href:"https://web.dev/browser-level-image-lazy-loading/",target:"_blank",rel:"noopener noreferrer"}},[t._v("lazy load"),e("OutboundLink")],1),t._v("，"),e("a",{attrs:{href:"https://web.dev/reduce-javascript-payloads-with-code-splitting/",target:"_blank",rel:"noopener noreferrer"}},[t._v("code-splitting"),e("OutboundLink")],1),t._v(" 等 "),e("a",{attrs:{href:"https://web.dev/fast/",target:"_blank",rel:"noopener noreferrer"}},[t._v("其他优化"),e("OutboundLink")],1),t._v(" 手段，让第一次加载的资源更少")])]),t._v(" "),e("h2",{attrs:{id:"分析rail用的工具"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分析rail用的工具"}},[t._v("#")]),t._v(" 分析RAIL用的工具")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://developers.google.com/web/tools/chrome-devtools",target:"_blank",rel:"noopener noreferrer"}},[t._v("Chrome DevTools"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://web.dev/measure/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lighthouse"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://webpagetest.org/easy",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebPageTest"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);